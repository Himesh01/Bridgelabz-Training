-- ============================================================
-- Problem - Transaction Management (Banking System)
-- Table: account, transaction_history
-- Database: practice_db
-- ============================================================

-- mysql>
CREATE TABLE account (
	account_id INT PRIMARY KEY AUTO_INCREMENT,
	holder_name VARCHAR(60) NOT NULL,
	balance DECIMAL(12,2) NOT NULL
);

/* o/p
Query OK, 0 rows affected (0.02 sec)
*/

-- mysql>
CREATE TABLE transaction_history (
	txn_id INT PRIMARY KEY AUTO_INCREMENT,
	from_account INT,
	to_account INT,
	amount DECIMAL(12,2),
	txn_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	FOREIGN KEY (from_account) REFERENCES account(account_id),
	FOREIGN KEY (to_account) REFERENCES account(account_id)
);

/* o/p
Query OK, 0 rows affected (0.02 sec)
*/

-- mysql>
DESC account;

/* o/p
+-------------+---------------+------+-----+---------+----------------+
| Field       | Type          | Null | Key | Default | Extra          |
+-------------+---------------+------+-----+---------+----------------+
| account_id  | int           | NO   | PRI | NULL    | auto_increment |
| holder_name | varchar(60)   | NO   |     | NULL    |                |
| balance     | decimal(12,2) | NO   |     | NULL    |                |
+-------------+---------------+------+-----+---------+----------------+
3 rows in set (0.00 sec)
*/

-- mysql>
INSERT INTO account (holder_name, balance) VALUES
('Himesh Kurmi', 100000),
('Nageshwar Patel', 75000),
('Rajeev Kurmi', 120000),
('Lucky Pal', 90000);

/* o/p
Query OK, 4 rows affected (0.01 sec)
Records: 4  Duplicates: 0  Warnings: 0
*/

-- mysql>
SELECT * FROM account;

/* o/p
+------------+-----------------+-----------+
| account_id | holder_name     | balance   |
+------------+-----------------+-----------+
|          1 | Himesh Kurmi    |  82000.00 |
|          2 | Nageshwar Patel |  75000.00 |
|          3 | Rajeev Kurmi    | 121000.00 |
|          4 | Lucky Pal       | 107000.00 |
+------------+-----------------+-----------+
4 rows in set (0.01 sec)
*/

-- TRANSFER MONEY
-- mysql>
START TRANSACTION;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
UPDATE account
SET balance = balance - 15000
WHERE account_id = 1;

/* o/p
Query OK, 1 row affected (0.01 sec)
*/

-- mysql>
UPDATE account
SET balance = balance + 15000
WHERE account_id = 4;

/* o/p
Query OK, 1 row affected (0.01 sec)
*/

-- mysql>
INSERT INTO transaction_history (from_account, to_account, amount)
VALUES (1, 4, 15000);

/* o/p
Query OK, 1 row affected (0.01 sec)
*/

-- mysql>
COMMIT;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- ============================================================
-- CHECK BALANCE
-- ============================================================

-- mysql>
SELECT account_id, holder_name, balance
FROM account
WHERE holder_name = 'Naruto Uzumaki';

/* o/p
+------------+----------------+-----------+
| account_id | holder_name    | balance   |
+------------+----------------+-----------+
|          1 | Himesh Kurmi	  |  85000.00 |
+------------+----------------+-----------+
1 row in set (0.00 sec)
*/

-- mysql>
SELECT account_id, holder_name, balance
FROM account
WHERE holder_name = 'Lucky Pal';

/* o/p
+------------+----------------+-----------+
| account_id | holder_name    | balance   |
+------------+----------------+-----------+
|          4 | Lucky Pal	  | 105000.00 |
+------------+----------------+-----------+
1 row in set (0.00 sec)
*/

-- ============================================================
-- TRANSACTION HISTORY
-- ============================================================

-- mysql>
SELECT * FROM transaction_history;

/* o/p
+--------+--------------+------------+----------+---------------------+
| txn_id | from_account | to_account | amount   | txn_time           |
+--------+--------------+------------+----------+---------------------+
|      1 |            1 |          4 | 15000.00 | 2026-02-07 12:30:10 |
+--------+--------------+------------+----------+---------------------+
1 row in set (0.00 sec)
*/

-- mysql>
START TRANSACTION;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
UPDATE account
SET balance = balance - 200000
WHERE account_id = 2;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
ROLLBACK;

/* o/p
Query OK, 0 rows affected (0.00 sec)
*/

-- mysql>
SELECT * FROM account WHERE account_id = 2;

/* o/p
+------------+------------------+-----------+
| account_id | holder_name      | balance   |
+------------+------------------+-----------+
|          2 | Nageshwar Patel  | 75000.00  |
+------------+------------------+-----------+
1 row in set (0.00 sec)
*/